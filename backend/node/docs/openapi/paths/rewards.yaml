paths:
  /api/rewards:
    get:
      operationId: listRewards
      tags:
        - Rewards
      summary: Listar todas las recompensas
      description: Obtiene la lista de todas las recompensas disponibles
      security:
        - BearerAuth: []
      parameters:
        - $ref: ../components/parameters.yaml#/components/parameters/AvailableQueryParam
          description: Filtrar solo recompensas disponibles
      responses:
        '200':
          description: Lista de recompensas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: ../components/schemas/rewards.yaml#/components/schemas/RewardResponse
        '401':
          description: No autorizado
          content:
            application/json:
              schema:
                $ref: ../components/common.yaml#/components/schemas/Error
    post:
      operationId: createReward
      tags:
        - Rewards
      summary: Crear una nueva recompensa
      description: Crea una nueva recompensa en el sistema (admin)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components/common.yaml#/components/schemas/CreateRewardRequest
      responses:
        '201':
          description: Recompensa creada exitosamente
          content:
            application/json:
              schema:
                $ref: ../components/schemas/rewards.yaml#/components/schemas/RewardResponse
        '400':
          $ref: ../components/responses.yaml#/components/responses/BadRequest
        '401':
          description: No autorizado
          content:
            application/json:
              schema:
                $ref: ../components/common.yaml#/components/schemas/Error
  /api/rewards/{id}:
    get:
      operationId: getRewardById
      tags:
        - Rewards
      summary: Obtener una recompensa por ID
      description: Obtiene los detalles de una recompensa específica
      security:
        - BearerAuth: []
      parameters:
        - $ref: ../components/parameters.yaml#/components/parameters/IdPathParam
          description: ID de la recompensa
      responses:
        '200':
          description: Detalles de la recompensa
          content:
            application/json:
              schema:
                $ref: ../components/schemas/rewards.yaml#/components/schemas/RewardResponse
        '404':
          description: Recompensa no encontrada
          content:
            application/json:
              schema:
                $ref: ../components/common.yaml#/components/schemas/Error
    put:
      operationId: updateReward
      tags:
        - Rewards
      summary: Actualizar una recompensa
      description: Actualiza los datos de una recompensa existente (admin)
      security:
        - BearerAuth: []
      parameters:
        - $ref: ../components/parameters.yaml#/components/parameters/IdPathParam
          description: ID de la recompensa
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components/common.yaml#/components/schemas/UpdateRewardRequest
      responses:
        '200':
          description: Recompensa actualizada
          content:
            application/json:
              schema:
                $ref: ../components/schemas/rewards.yaml#/components/schemas/RewardResponse
        '400':
          $ref: ../components/responses.yaml#/components/responses/BadRequest
        '404':
          description: Recompensa no encontrada
          content:
            application/json:
              schema:
                $ref: ../components/common.yaml#/components/schemas/Error
    delete:
      operationId: deleteReward
      tags:
        - Rewards
      summary: Eliminar una recompensa
      description: Elimina lógicamente una recompensa (soft delete)
      security:
        - BearerAuth: []
      parameters:
        - $ref: ../components/parameters.yaml#/components/parameters/IdPathParam
          description: ID de la recompensa
      responses:
        '204':
          description: Recompensa eliminada exitosamente
        '404':
          description: Recompensa no encontrada
          content:
            application/json:
              schema:
                $ref: ../components/common.yaml#/components/schemas/Error

  /api/rewards/{rewardId}/claim:
    post:
      operationId: claimReward
      tags:
        - Rewards
      summary: Canjear una recompensa
      description: Canjea una recompensa por tokens
      security:
        - BearerAuth: []
      parameters:
        - name: rewardId
          in: path
          required: true
          schema:
            type: integer
          description: ID de la recompensa a canjear
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - tokens_spent
              properties:
                tokens_spent:
                  type: number
                  description: Cantidad de tokens gastados
                code_id:
                  type: integer
                  description: ID del código de recompensa (opcional)
                expires_at:
                  type: string
                  format: date-time
                  description: Fecha de expiración (opcional)
      responses:
        '201':
          description: Recompensa canjeada exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  id_claimed_reward:
                    type: integer
                  id_user_profile:
                    type: integer
                  id_reward:
                    type: integer
                  id_code:
                    type: integer
                  claimed_date:
                    type: string
                    format: date-time
                  status:
                    type: string
                    enum: [PENDING, ACTIVE, USED, EXPIRED]
                  tokens_spent:
                    type: number
                  used_at:
                    type: string
                    format: date-time
                  expires_at:
                    type: string
                    format: date-time
                  reward:
                    $ref: ../components/schemas/rewards.yaml#/components/schemas/RewardResponse
                  code:
                    type: object
                    properties:
                      id_code:
                        type: integer
                      code:
                        type: string
        '400':
          $ref: ../components/responses.yaml#/components/responses/BadRequest
        '401':
          description: No autorizado
          content:
            application/json:
              schema:
                $ref: ../components/common.yaml#/components/schemas/Error

  /api/users/{userId}/claimed-rewards:
    get:
      operationId: listClaimedRewards
      tags:
        - Rewards
      summary: Listar recompensas canjeadas
      description: Lista todas las recompensas canjeadas por un usuario
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
          description: ID del usuario
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, ACTIVE, USED, EXPIRED]
          description: Filtrar por estado
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Lista de recompensas canjeadas
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      type: object
                  page:
                    type: integer
                  limit:
                    type: integer
                  total:
                    type: integer
                  totalPages:
                    type: integer
        '401':
          description: No autorizado
          content:
            application/json:
              schema:
                $ref: ../components/common.yaml#/components/schemas/Error

  /api/claimed-rewards/{claimedRewardId}:
    get:
      operationId: getClaimedReward
      tags:
        - Rewards
      summary: Obtener recompensa canjeada
      description: Obtiene los detalles de una recompensa canjeada
      security:
        - BearerAuth: []
      parameters:
        - name: claimedRewardId
          in: path
          required: true
          schema:
            type: integer
          description: ID de la recompensa canjeada
      responses:
        '200':
          description: Detalles de la recompensa canjeada
          content:
            application/json:
              schema:
                type: object
        '404':
          description: Recompensa canjeada no encontrada
          content:
            application/json:
              schema:
                $ref: ../components/common.yaml#/components/schemas/Error

  /api/claimed-rewards/{claimedRewardId}/use:
    post:
      operationId: markClaimedRewardAsUsed
      tags:
        - Rewards
      summary: Marcar recompensa como usada
      description: Marca una recompensa canjeada como usada
      security:
        - BearerAuth: []
      parameters:
        - name: claimedRewardId
          in: path
          required: true
          schema:
            type: integer
          description: ID de la recompensa canjeada
      responses:
        '200':
          description: Recompensa marcada como usada
          content:
            application/json:
              schema:
                type: object
        '400':
          $ref: ../components/responses.yaml#/components/responses/BadRequest
        '401':
          description: No autorizado
          content:
            application/json:
              schema:
                $ref: ../components/common.yaml#/components/schemas/Error
