paths:
  /api/gyms:
    get:
      operationId: listGyms
      tags:
        - Gyms
      summary: Listar gimnasios
      description: Obtiene la lista de gimnasios con paginación
      parameters:
        - $ref: '../components/parameters.yaml#/components/parameters/PageParam'
        - $ref: '../components/parameters.yaml#/components/parameters/LimitParam'
        - name: city
          in: query
          schema:
            type: string
          description: Filtrar por ciudad
        - name: is_active
          in: query
          schema:
            type: boolean
          description: Filtrar solo gimnasios activos
        - name: featured
          in: query
          schema:
            type: boolean
          description: Filtrar solo gimnasios destacados
      responses:
        '200':
          description: Lista paginada de gimnasios
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/GymListResponse'
        '400':
          $ref: '../components/responses.yaml#/components/responses/BadRequest'
    post:
      operationId: createGym
      tags:
        - Gyms
      summary: Crear un nuevo gimnasio
      description: Crea un nuevo gimnasio en el sistema (admin)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/schemas/gyms.yaml#/components/schemas/CreateGymRequest'
      responses:
        '201':
          description: Gimnasio creado exitosamente
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/GymResponse'
        '400':
          $ref: '../components/responses.yaml#/components/responses/BadRequest'
        '401':
          description: No autorizado
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
  /api/gyms/{gymId}:
    parameters:
      - $ref: '../components/parameters.yaml#/components/parameters/GymIdPathParam'
    get:
      operationId: getGym
      tags:
        - Gyms
      summary: Obtener detalle de un gimnasio
      responses:
        '200':
          description: Gimnasio encontrado
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/GymResponse'
        '404':
          $ref: '../components/responses.yaml#/components/responses/NotFound'
    put:
      operationId: updateGym
      tags:
        - Gyms
      summary: Actualizar un gimnasio
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/schemas/gyms.yaml#/components/schemas/UpdateGymRequest'
      responses:
        '200':
          description: Gimnasio actualizado
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/GymResponse'
        '400':
          $ref: '../components/responses.yaml#/components/responses/BadRequest'
        '404':
          $ref: '../components/responses.yaml#/components/responses/NotFound'
    delete:
      operationId: deleteGym
      tags:
        - Gyms
      summary: Eliminar un gimnasio
      security:
        - BearerAuth: []
      responses:
        '204':
          description: Gimnasio eliminado
        '404':
          $ref: '../components/responses.yaml#/components/responses/NotFound'
  # /api/gyms/tipos - ELIMINADO: Los tipos ahora están en gym.services como array de strings
  /api/gyms/amenidades:
    get:
      operationId: listGymAmenities
      tags:
        - Gyms
      summary: Listar amenities disponibles
      responses:
        '200':
          description: Amenities registradas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../components/schemas/gyms.yaml#/components/schemas/GymAmenity'
        '400':
          description: Parámetros inválidos
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
        '500':
          $ref: '../components/responses.yaml#/components/responses/InternalServerError'
  /api/gyms/{gymId}/schedules:
    parameters:
      - $ref: '../components/parameters.yaml#/components/parameters/GymIdPathParam'
    get:
      operationId: listGymSchedules
      tags:
        - Gym Schedules
      summary: Listar horarios regulares de un gimnasio
      description: Retorna los horarios de la semana (lunes a domingo)
      responses:
        '200':
          description: Horarios encontrados
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/GymSchedulesWeekResponse'
        '404':
          $ref: '../components/responses.yaml#/components/responses/NotFound'
    post:
      operationId: createGymSchedule
      tags:
        - Gym Schedules
      summary: Crear horario regular para un día
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/schemas/gyms.yaml#/components/schemas/CreateGymScheduleRequest'
      responses:
        '201':
          description: Horario creado
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/GymScheduleResponse'
        '400':
          $ref: '../components/responses.yaml#/components/responses/BadRequest'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
  /api/gyms/{gymId}/reviews:
    parameters:
      - $ref: '../components/parameters.yaml#/components/parameters/GymIdPathParam'
    get:
      operationId: listGymReviews
      tags:
        - Gym Reviews
      summary: Listar reseñas de un gimnasio
      parameters:
        - $ref: '../components/parameters.yaml#/components/parameters/PageParam'
        - $ref: '../components/parameters.yaml#/components/parameters/LimitParam'
        - name: sortBy
          in: query
          schema:
            type: string
            enum:
              - created_at
              - rating
              - helpful_count
            default: created_at
        - $ref: '../components/parameters.yaml#/components/parameters/OrderParam'
        - name: min_rating
          in: query
          schema:
            type: number
            minimum: 1
            maximum: 5
        - name: with_comment_only
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Lista de reseñas
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/PaginatedGymReviewsResponse'
        '404':
          $ref: '../components/responses.yaml#/components/responses/NotFound'
    post:
      operationId: createGymReview
      tags:
        - Gym Reviews
      summary: Crear una reseña para un gimnasio
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/schemas/gyms.yaml#/components/schemas/CreateGymReviewRequest'
      responses:
        '201':
          description: Reseña creada
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/GymReviewResponse'
        '400':
          $ref: '../components/responses.yaml#/components/responses/BadRequest'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
        '409':
          description: Usuario ya tiene una reseña para este gimnasio
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
  /api/gyms/{gymId}/reviews/stats:
    parameters:
      - $ref: '../components/parameters.yaml#/components/parameters/GymIdPathParam'
    get:
      operationId: getGymRatingStats
      tags:
        - Gym Reviews
      summary: Obtener estadísticas de rating de un gimnasio
      description: Devuelve estadísticas agregadas de las reseñas de un gimnasio (promedio, distribución por estrellas, etc.)
      responses:
        '200':
          description: Estadísticas de rating del gimnasio
          content:
            application/json:
              schema:
                type: object
                required:
                  - id_gym
                  - avg_rating
                  - total_reviews
                properties:
                  id_gym:
                    type: integer
                  avg_rating:
                    type: number
                    format: float
                    minimum: 0
                    maximum: 5
                  total_reviews:
                    type: integer
                    minimum: 0
                  rating_5_count:
                    type: integer
                  rating_4_count:
                    type: integer
                  rating_3_count:
                    type: integer
                  rating_2_count:
                    type: integer
                  rating_1_count:
                    type: integer
                  avg_cleanliness:
                    type: number
                    format: float
                    nullable: true
                  avg_equipment:
                    type: number
                    format: float
                    nullable: true
                  avg_staff:
                    type: number
                    format: float
                    nullable: true
                  avg_value:
                    type: number
                    format: float
                    nullable: true
                  last_review_date:
                    type: string
                    format: date-time
                    nullable: true
                  updated_at:
                    type: string
                    format: date-time
        '404':
          $ref: '../components/responses.yaml#/components/responses/NotFound'
  /api/gyms/{gymId}/payments:
    parameters:
      - $ref: '../components/parameters.yaml#/components/parameters/GymIdPathParam'
    get:
      operationId: listGymPayments
      tags:
        - Gym Payments
      summary: Listar pagos de un gimnasio
      security:
        - BearerAuth: []
      parameters:
        - $ref: '../components/parameters.yaml#/components/parameters/PageParam'
        - $ref: '../components/parameters.yaml#/components/parameters/LimitParam'
        - name: status
          in: query
          schema:
            type: string
            enum:
              - PENDING
              - COMPLETED
              - FAILED
              - REFUNDED
        - name: from_date
          in: query
          schema:
            type: string
            format: date
        - name: to_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Lista de pagos
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/PaginatedGymPaymentsResponse'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
        '403':
          $ref: '../components/responses.yaml#/components/responses/Forbidden'
    post:
      operationId: createGymPayment
      tags:
        - Gym Payments
      summary: Registrar un pago de suscripción a gimnasio
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/schemas/gyms.yaml#/components/schemas/CreateGymPaymentRequest'
      responses:
        '201':
          description: Pago registrado
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/GymPaymentResponse'
        '400':
          $ref: '../components/responses.yaml#/components/responses/BadRequest'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
  /api/gym-reviews:
    get:
      operationId: listAllGymReviews
      tags:
        - Gym Reviews
      summary: Listar todas las reseñas de gimnasios
      description: Obtiene la lista de reseñas de todos los gimnasios con paginación
      parameters:
        - $ref: '../components/parameters.yaml#/components/parameters/PageParam'
        - $ref: '../components/parameters.yaml#/components/parameters/LimitParam'
        - name: sortBy
          in: query
          schema:
            type: string
            enum:
              - created_at
              - rating
              - helpful_count
            default: created_at
        - $ref: '../components/parameters.yaml#/components/parameters/OrderParam'
        - name: min_rating
          in: query
          schema:
            type: number
            minimum: 1
            maximum: 5
        - name: with_comment_only
          in: query
          schema:
            type: boolean
            default: false
        - name: gym_id
          in: query
          schema:
            type: integer
          description: Filtrar por ID de gimnasio
      responses:
        '200':
          description: Lista paginada de reseñas
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/PaginatedGymReviewsResponse'
        '400':
          $ref: '../components/responses.yaml#/components/responses/BadRequest'
  /api/gym-reviews/{reviewId}:
    parameters:
      - name: reviewId
        in: path
        required: true
        schema:
          type: integer
        description: ID de la reseña
    put:
      operationId: updateGymReview
      tags:
        - Gym Reviews
      summary: Actualizar una reseña
      description: Actualiza una reseña existente (admin o autor)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/schemas/gyms.yaml#/components/schemas/CreateGymReviewRequest'
      responses:
        '200':
          description: Reseña actualizada
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/GymReviewResponse'
        '400':
          $ref: '../components/responses.yaml#/components/responses/BadRequest'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
        '403':
          $ref: '../components/responses.yaml#/components/responses/Forbidden'
        '404':
          $ref: '../components/responses.yaml#/components/responses/NotFound'
    patch:
      operationId: patchGymReview
      tags:
        - Gym Reviews
      summary: Actualizar una reseña (PATCH)
      description: Actualiza una reseña existente (admin o autor) - Alias de PUT
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/schemas/gyms.yaml#/components/schemas/CreateGymReviewRequest'
      responses:
        '200':
          description: Reseña actualizada
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/GymReviewResponse'
        '400':
          $ref: '../components/responses.yaml#/components/responses/BadRequest'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
        '403':
          $ref: '../components/responses.yaml#/components/responses/Forbidden'
        '404':
          $ref: '../components/responses.yaml#/components/responses/NotFound'
    delete:
      operationId: deleteGymReview
      tags:
        - Gym Reviews
      summary: Eliminar una reseña
      description: Elimina una reseña (admin o autor)
      security:
        - BearerAuth: []
      responses:
        '204':
          description: Reseña eliminada exitosamente
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
        '403':
          $ref: '../components/responses.yaml#/components/responses/Forbidden'
        '404':
          $ref: '../components/responses.yaml#/components/responses/NotFound'
  /api/reviews/{id_review}/helpful:
    parameters:
      - name: id_review
        in: path
        required: true
        schema:
          type: integer
        description: ID de la reseña
    post:
      operationId: markReviewHelpful
      tags:
        - Gym Reviews
      summary: Marcar una reseña como útil
      description: Marca una reseña como útil. El usuario no puede marcar su propia reseña.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Reseña marcada como útil exitosamente
          content:
            application/json:
              schema:
                $ref: '../components/schemas/gyms.yaml#/components/schemas/GymReviewResponse'
        '400':
          description: Ya marcaste esta review como útil o es tu propia review
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
        '403':
          description: Requiere rol de usuario de la app
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
        '404':
          $ref: '../components/responses.yaml#/components/responses/NotFound'
    delete:
      operationId: unmarkReviewHelpful
      tags:
        - Gym Reviews
      summary: Remover marca de útil de una reseña
      description: Remueve el voto de utilidad de una reseña
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Marca de útil removida exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  removed:
                    type: boolean
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
        '403':
          description: Requiere rol de usuario de la app
          content:
            application/json:
              schema:
                $ref: '../components/common.yaml#/components/schemas/Error'
        '404':
          $ref: '../components/responses.yaml#/components/responses/NotFound'