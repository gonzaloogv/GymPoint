openapi: 3.1.0
info:
  title: GymPoint API
  version: 0.1.0
  description: >
    Plataforma GymPoint para gestión de cuentas, membresías y catálogos de gimnasios.
    El contrato sigue un enfoque OpenAPI-first; todas las integraciones deben validar
    requests y responses contra este documento.
  contact:
    name: GymPoint Platform Team
    url: https://www.gympoint.example.com
    email: devs@gympoint.example.com
  license:
    name: ISC
    identifier: ISC
servers:
  - url: http://127.0.0.1:3000
    description: Entorno local (Docker)
  - url: https://api.gympoint.app
    description: Producción
tags:
  - name: Auth
    description: Flujos de autenticación, registro y manejo de tokens.
  - name: Users
    description: Gestión de perfiles de usuario, preferencias y configuraciones.
  - name: Gyms
    description: Catálogo de gimnasios, amenities y administración.
  - name: Gym Schedules
    description: Horarios regulares y especiales de gimnasios.
  - name: Gym Reviews
    description: Reseñas y valoraciones de gimnasios.
  - name: Gym Payments
    description: Pagos de suscripciones a gimnasios.
security: []
paths:
  /api/auth/register:
    post:
      operationId: registerAccount
      tags: [Auth]
      summary: Registrar una nueva cuenta de usuario
      description: >
        Crea una `Account`, `UserProfile`, `Frequency` y `Streak` iniciales. Retorna los
        tokens de autenticación y la información básica del usuario.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Registro exitoso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
        '400':
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Email ya registrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/auth/login:
    post:
      operationId: loginWithPassword
      tags: [Auth]
      summary: Autenticación por email y contraseña
      description: >
        Valida las credenciales y emite un nuevo par de tokens JWT/refresh.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Autenticación exitosa
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
        '400':
          description: Request inválida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Credenciales inválidas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/auth/google:
    post:
      operationId: loginWithGoogle
      tags: [Auth]
      summary: Login con Google OAuth
      description: >
        Valida un ID token de Google. Crea o vincula la cuenta y responde con
        tokens de acceso.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GoogleLoginRequest'
      responses:
        '200':
          description: Autenticación exitosa
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
        '400':
          description: Request inválida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Token de Google inválido
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/auth/refresh-token:
    post:
      operationId: refreshAccessToken
      tags: [Auth]
      summary: Renovar access token usando refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: Nuevo access token emitido
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponse'
        '400':
          description: Request inválida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Refresh token inválido o expirado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/auth/logout:
    post:
      operationId: revokeRefreshToken
      tags: [Auth]
      summary: Revocar un refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
      responses:
        '204':
          description: Refresh token revocado
        '400':
          description: Request inválida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/users/me:
    get:
      operationId: getUserProfile
      tags: [Users]
      summary: Obtener perfil del usuario actual
      description: >
        Devuelve la información completa del perfil del usuario autenticado.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Perfil del usuario
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
        '401':
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Usuario no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      operationId: updateUserProfile
      tags: [Users]
      summary: Actualizar perfil del usuario actual
      description: >
        Actualiza los datos del perfil del usuario autenticado. Solo se actualizan
        los campos proporcionados en el request body.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserProfileRequest'
      responses:
        '200':
          description: Perfil actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
        '400':
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Usuario no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      operationId: requestAccountDeletion
      tags: [Users]
      summary: Solicitar eliminación de cuenta
      description: >
        Inicia el proceso de eliminación de cuenta con período de gracia.
        La cuenta no se eliminará inmediatamente sino después del período configurado.
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestAccountDeletionRequest'
      responses:
        '200':
          description: Solicitud de eliminación registrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDeletionResponse'
        '400':
          description: Request inválida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/users/me/email:
    put:
      operationId: updateUserEmail
      tags: [Users]
      summary: Actualizar email del usuario
      description: >
        Actualiza el email del usuario autenticado. Requiere verificación posterior.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEmailRequest'
      responses:
        '200':
          description: Email actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailUpdateResponse'
        '400':
          description: Email inválido o ya en uso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/users/me/deletion-request:
    get:
      operationId: getAccountDeletionStatus
      tags: [Users]
      summary: Obtener estado de solicitud de eliminación
      description: >
        Consulta el estado de una solicitud de eliminación de cuenta pendiente.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Estado de la solicitud
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDeletionStatusResponse'
        '401':
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      operationId: cancelAccountDeletion
      tags: [Users]
      summary: Cancelar solicitud de eliminación
      description: >
        Cancela una solicitud de eliminación de cuenta pendiente.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Solicitud cancelada exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDeletionResponse'
        '400':
          description: No hay solicitud pendiente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/users/me/notification-settings:
    get:
      operationId: getNotificationSettings
      tags: [Users]
      summary: Obtener configuración de notificaciones
      description: >
        Devuelve las preferencias de notificaciones del usuario autenticado.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Configuración de notificaciones
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationSettingsResponse'
        '401':
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      operationId: updateNotificationSettings
      tags: [Users]
      summary: Actualizar configuración de notificaciones
      description: >
        Actualiza las preferencias de notificaciones del usuario autenticado.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateNotificationSettingsRequest'
      responses:
        '200':
          description: Configuración actualizada exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationSettingsResponse'
        '400':
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/users/{userId}:
    get:
      operationId: getUserById
      tags: [Users]
      summary: Obtener perfil de usuario por ID (admin)
      description: >
        Devuelve la información del perfil de un usuario específico. Solo para administradores.
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: integer
            minimum: 1
          description: ID del perfil de usuario
      responses:
        '200':
          description: Perfil del usuario
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
        '401':
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: No autorizado (requiere rol admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Usuario no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/users/{userId}/tokens:
    post:
      operationId: updateUserTokens
      tags: [Users]
      summary: Actualizar tokens de un usuario (admin)
      description: >
        Incrementa o decrementa el balance de tokens de un usuario. Solo para administradores.
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: integer
            minimum: 1
          description: ID del perfil de usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTokensRequest'
      responses:
        '200':
          description: Tokens actualizados exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokensUpdateResponse'
        '400':
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: No autorizado (requiere rol admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Usuario no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/users/{userId}/subscription:
    put:
      operationId: updateUserSubscription
      tags: [Users]
      summary: Actualizar suscripción de un usuario (admin)
      description: >
        Cambia el nivel de suscripción de un usuario. Solo para administradores.
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: integer
            minimum: 1
          description: ID del perfil de usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSubscriptionRequest'
      responses:
        '200':
          description: Suscripción actualizada exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
        '400':
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: No autorizado (requiere rol admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Usuario no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/gyms:
    get:
      operationId: listGyms
      tags: [Gyms]
      summary: Listar gimnasios
      description: >
        Lista gimnasios disponibles con paginación y ordenamientos controlados.
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/GymSortParam'
        - name: city
          in: query
          required: false
          schema:
            type: string
            maxLength: 80
          description: Filtrar por ciudad exacta.
      responses:
        '200':
          description: Resultado paginado de gimnasios
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymListResponse'
        '400':
          description: Parámetros inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      operationId: createGym
      tags: [Gyms]
      summary: Crear un gimnasio
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGymRequest'
      responses:
        '201':
          description: Gimnasio creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymResponse'
        '400':
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Permisos insuficientes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/gyms/{gymId}:
    parameters:
      - $ref: '#/components/parameters/GymIdPathParam'
    get:
      operationId: getGym
      tags: [Gyms]
      summary: Obtener detalle de un gimnasio
      responses:
        '200':
          description: Gimnasio encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymResponse'
        '404':
          description: Gimnasio no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      operationId: updateGym
      tags: [Gyms]
      summary: Actualizar un gimnasio
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateGymRequest'
      responses:
        '200':
          description: Gimnasio actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymResponse'
        '400':
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Gimnasio no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      operationId: deleteGym
      tags: [Gyms]
      summary: Eliminar un gimnasio
      security:
        - BearerAuth: []
      responses:
        '204':
          description: Gimnasio eliminado
        '404':
          description: Gimnasio no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/gyms/tipos:
    get:
      operationId: listGymTypes
      tags: [Gyms]
      summary: Listar tipos de gimnasios
      responses:
        '200':
          description: Lista de tipos disponibles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymTypeList'
        '400':
          description: Parámetros inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Error interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/gyms/amenidades:
    get:
      operationId: listGymAmenities
      tags: [Gyms]
      summary: Listar amenities disponibles
      responses:
        '200':
          description: Amenities registradas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GymAmenity'
        '400':
          description: Parámetros inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Error interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ==================================================================================
  # LOTE 4: GYM SCHEDULES, REVIEWS, PAYMENTS
  # ==================================================================================

  /api/gyms/{gymId}/schedules:
    parameters:
      - $ref: '#/components/parameters/GymIdPathParam'
    get:
      operationId: listGymSchedules
      tags: [Gym Schedules]
      summary: Listar horarios regulares de un gimnasio
      description: Retorna los horarios de la semana (lunes a domingo)
      responses:
        '200':
          description: Horarios encontrados
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymSchedulesWeekResponse'
        '404':
          description: Gimnasio no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      operationId: createGymSchedule
      tags: [Gym Schedules]
      summary: Crear horario regular para un día
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGymScheduleRequest'
      responses:
        '201':
          description: Horario creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymScheduleResponse'
        '400':
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/gyms/{gymId}/reviews:
    parameters:
      - $ref: '#/components/parameters/GymIdPathParam'
    get:
      operationId: listGymReviews
      tags: [Gym Reviews]
      summary: Listar reseñas de un gimnasio
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [created_at, rating, helpful_count]
            default: created_at
        - $ref: '#/components/parameters/Order'
        - name: min_rating
          in: query
          schema:
            type: number
            minimum: 1
            maximum: 5
        - name: with_comment_only
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Lista de reseñas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedGymReviewsResponse'
        '404':
          description: Gimnasio no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      operationId: createGymReview
      tags: [Gym Reviews]
      summary: Crear una reseña para un gimnasio
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGymReviewRequest'
      responses:
        '201':
          description: Reseña creada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymReviewResponse'
        '400':
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Usuario ya tiene una reseña para este gimnasio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/gyms/{gymId}/payments:
    parameters:
      - $ref: '#/components/parameters/GymIdPathParam'
    get:
      operationId: listGymPayments
      tags: [Gym Payments]
      summary: Listar pagos de un gimnasio
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, COMPLETED, FAILED, REFUNDED]
        - name: from_date
          in: query
          schema:
            type: string
            format: date
        - name: to_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Lista de pagos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedGymPaymentsResponse'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Permisos insuficientes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      operationId: createGymPayment
      tags: [Gym Payments]
      summary: Registrar un pago de suscripción a gimnasio
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGymPaymentRequest'
      responses:
        '201':
          description: Pago registrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymPaymentResponse'
        '400':
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Autenticación requerida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    PageParam:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Número de página (1-indexado).
    LimitParam:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
      description: Tamaño máximo de página.
    OrderParam:
      name: order
      in: query
      required: false
      schema:
        type: string
        enum: [asc, desc]
        default: desc
      description: Dirección de ordenamiento.
    GymSortParam:
      name: sortBy
      in: query
      required: false
      schema:
        type: string
        enum: [created_at, name, city, month_price]
        default: created_at
      description: Campo permitido para ordenar gimnasios.
    GymIdPathParam:
      name: gymId
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
      description: Identificador del gimnasio (`id_gym`).
  schemas:
    Error:
      type: object
      required: [code, message]
      additionalProperties: false
      properties:
        code:
          type: string
          description: Código de error interno.
          example: INVALID_DATA
        message:
          type: string
          description: Descripción legible del error.
          example: Datos inválidos.
        details:
          type: array
          description: Lista opcional de detalles adicionales.
          items:
            type: object
    AuthSuccessResponse:
      type: object
      required: [tokens, user]
      properties:
        tokens:
          $ref: '#/components/schemas/AuthTokenPair'
        user:
          $ref: '#/components/schemas/AuthUser'
    AuthTokenPair:
      type: object
      required: [accessToken, refreshToken]
      additionalProperties: false
      properties:
        accessToken:
          type: string
          description: JWT con vigencia corta (15 minutos).
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refreshToken:
          type: string
          description: Token de renovación con vigencia de 30 días.
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    AuthUser:
      type: object
      required: [id_account, email, email_verified, roles, profile]
      additionalProperties: false
      properties:
        id_account:
          type: integer
        email:
          type: string
          format: email
        email_verified:
          type: boolean
        roles:
          type: array
          minItems: 1
          items:
            type: string
            example: USER
        profile:
          $ref: '#/components/schemas/UserProfileSummary'
    UserProfileSummary:
      type: object
      required: [id_user_profile, name, lastname, subscription]
      additionalProperties: false
      properties:
        id_user_profile:
          type: integer
        name:
          type: string
          example: Ana
        lastname:
          type: string
          example: Torres
        subscription:
          type: string
          enum: [FREE, PREMIUM]
          description: Nivel actual de la app.
        premium_since:
          type:
            - string
            - 'null'
          format: date-time
        tokens_balance:
          type: integer
          minimum: 0
        tokens_lifetime:
          type: integer
          minimum: 0
        locality:
          type:
            - string
            - 'null'
        gender:
          oneOf:
            - type: string
              enum: [M, F, O]
            - type: 'null'
        birth_date:
          type:
            - string
            - 'null'
          format: date
    RegisterRequest:
      type: object
      additionalProperties: false
      required:
        - email
        - password
        - name
        - lastname
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
          maxLength: 64
        name:
          type: string
          minLength: 2
          maxLength: 80
        lastname:
          type: string
          minLength: 2
          maxLength: 80
        gender:
          type: string
          enum: [M, F, O]
          default: O
        locality:
          type: string
          maxLength: 120
        birth_date:
          type:
            - string
            - 'null'
          format: date
        frequency_goal:
          type: integer
          minimum: 1
          maximum: 14
          default: 3
    LoginRequest:
      type: object
      additionalProperties: false
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
          maxLength: 64
    GoogleLoginRequest:
      type: object
      additionalProperties: false
      required: [idToken]
      properties:
        idToken:
          type: string
          description: ID token emitido por Google Sign-In.
    RefreshTokenRequest:
      type: object
      additionalProperties: false
      required: [refreshToken]
      properties:
        refreshToken:
          type: string
          description: Token de renovación vigente.
    RefreshTokenResponse:
      type: object
      additionalProperties: false
      required: [accessToken]
      properties:
        accessToken:
          type: string
          description: Nuevo JWT de acceso.
    LogoutRequest:
      type: object
      additionalProperties: false
      required: [refreshToken]
      properties:
        refreshToken:
          type: string
          description: Token a revocar.
    GymListResponse:
      type: object
      additionalProperties: false
      required: [page, limit, total, items]
      properties:
        page:
          type: integer
          minimum: 1
        limit:
          type: integer
          minimum: 1
        total:
          type: integer
          minimum: 0
        totalPages:
          type: integer
          minimum: 1
        items:
          type: array
          items:
            $ref: '#/components/schemas/GymResponse'
    GymResponse:
      type: object
      required:
        - id_gym
        - name
        - city
        - address
        - latitude
        - longitude
        - month_price
        - geofence_radius_meters
        - min_stay_minutes
        - created_at
        - updated_at
      properties:
        id_gym:
          type: integer
        name:
          type: string
          maxLength: 120
        description:
          type:
            - string
            - 'null'
        phone:
          type:
            - string
            - 'null'
        email:
          type:
            - string
            - 'null'
        website:
          type:
            - string
            - 'null'
        is_active:
          type:
            - boolean
            - 'null'
        verified:
          type:
            - boolean
            - 'null'
        featured:
          type:
            - boolean
            - 'null'
        auto_checkin_enabled:
          type:
            - boolean
            - 'null'
        city:
          type: string
        address:
          type: string
        latitude:
          type: number
          format: double
        longitude:
          type: number
          format: double
        month_price:
          type: number
          format: float
          minimum: 0
        week_price:
          type:
            - number
            - 'null'
          format: float
          minimum: 0
        geofence_radius_meters:
          type: integer
          minimum: 10
          maximum: 2000
        min_stay_minutes:
          type: integer
          minimum: 5
          maximum: 240
        is_favorite:
          type:
            - boolean
            - 'null'
        is_subscribed:
          type:
            - boolean
            - 'null'
        distance:
          type:
            - number
            - 'null'
          format: float
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    CreateGymRequest:
      type: object
      additionalProperties: false
      required:
        - name
        - city
        - address
        - latitude
        - longitude
        - month_price
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 120
        description:
          type: string
          maxLength: 2000
        city:
          type: string
          maxLength: 80
        address:
          type: string
          maxLength: 200
        latitude:
          type: number
          minimum: -90
          maximum: 90
        longitude:
          type: number
          minimum: -180
          maximum: 180
        phone:
          type: string
          maxLength: 40
        email:
          type: string
          format: email
        website:
          type: string
          format: uri
        social_media:
          type: array
          items:
            type: string
        month_price:
          type: number
          minimum: 0
        week_price:
          type: number
          minimum: 0
        geofence_radius_meters:
          type: integer
          minimum: 10
          maximum: 2000
          default: 100
        min_stay_minutes:
          type: integer
          minimum: 5
          maximum: 240
          default: 30
        id_types:
          type: array
          items:
            type: integer
            minimum: 1
        type_names:
          type: array
          items:
            type: string
        amenities:
          type: array
          items:
            type: integer
            minimum: 1
        rules:
          type: array
          items:
            type: string
    UpdateGymRequest:
      allOf:
        - $ref: '#/components/schemas/CreateGymRequest'
    GymAmenity:
      type: object
      required: [id_amenity, name]
      properties:
        id_amenity:
          type: integer
        name:
          type: string
        category:
          type:
            - string
            - 'null'
    GymTypeList:
      type: array
      items:
        type: string
    UserProfileResponse:
      type: object
      required:
        - id_user_profile
        - email
        - name
        - lastname
        - subscription
        - tokens
        - created_at
      additionalProperties: false
      properties:
        id_user_profile:
          type: integer
          description: ID único del perfil de usuario
          example: 42
        email:
          type: string
          format: email
          description: Email del usuario
          example: usuario@example.com
        name:
          type: string
          minLength: 2
          maxLength: 80
          description: Nombre del usuario
          example: Juan
        lastname:
          type: string
          minLength: 2
          maxLength: 80
          description: Apellido del usuario
          example: Pérez
        gender:
          oneOf:
            - type: string
              enum: [M, F, O]
            - type: 'null'
          description: Género del usuario
          example: M
        birth_date:
          oneOf:
            - type: string
              format: date
            - type: 'null'
          description: Fecha de nacimiento (YYYY-MM-DD)
          example: '1990-05-15'
        locality:
          oneOf:
            - type: string
            - type: 'null'
          description: Localidad del usuario
          example: Buenos Aires
        profile_picture_url:
          oneOf:
            - type: string
              format: uri
            - type: 'null'
          description: URL de la foto de perfil
        subscription:
          type: string
          enum: [FREE, PREMIUM]
          description: Nivel de suscripción actual
          example: FREE
        tokens:
          type: integer
          minimum: 0
          description: Balance actual de tokens
          example: 150
        preferred_language:
          type: string
          description: Idioma preferido (código ISO 639-1)
          example: es
        timezone:
          oneOf:
            - type: string
            - type: 'null'
          description: Zona horaria del usuario
          example: America/Argentina/Buenos_Aires
        onboarding_completed:
          type: boolean
          description: Indica si completó el onboarding
          example: true
        created_at:
          type: string
          format: date-time
          description: Fecha de creación del perfil
        updated_at:
          oneOf:
            - type: string
              format: date-time
            - type: 'null'
          description: Fecha de última actualización
    UpdateUserProfileRequest:
      type: object
      additionalProperties: false
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 80
          description: Nombre del usuario
        lastname:
          type: string
          minLength: 2
          maxLength: 80
          description: Apellido del usuario
        gender:
          type: string
          enum: [M, F, O]
          description: Género del usuario
        birth_date:
          type: string
          format: date
          description: Fecha de nacimiento (YYYY-MM-DD)
          example: '1990-05-15'
        locality:
          type: string
          maxLength: 100
          description: Localidad del usuario
        profile_picture_url:
          type: string
          format: uri
          description: URL de la foto de perfil
        preferred_language:
          type: string
          pattern: '^[a-z]{2}$'
          description: Idioma preferido (código ISO 639-1)
          example: es
        timezone:
          type: string
          description: Zona horaria del usuario
          example: America/Argentina/Buenos_Aires
        onboarding_completed:
          type: boolean
          description: Marca el onboarding como completado
    UpdateEmailRequest:
      type: object
      required: [email]
      additionalProperties: false
      properties:
        email:
          type: string
          format: email
          description: Nuevo email del usuario
          example: nuevo@example.com
    EmailUpdateResponse:
      type: object
      required: [email, email_verified]
      additionalProperties: false
      properties:
        email:
          type: string
          format: email
          description: Email actualizado
        email_verified:
          type: boolean
          description: Estado de verificación del email
          example: false
        message:
          type: string
          description: Mensaje informativo
          example: Email actualizado. Por favor verifica tu nuevo email.
    RequestAccountDeletionRequest:
      type: object
      additionalProperties: false
      properties:
        reason:
          type: string
          maxLength: 500
          description: Razón de la eliminación (opcional)
          example: Ya no uso la aplicación
    AccountDeletionResponse:
      type: object
      required: [status, scheduled_deletion_date]
      additionalProperties: false
      properties:
        id_account_deletion_request:
          type: integer
          description: ID de la solicitud de eliminación
        id_account:
          type: integer
          description: ID de la cuenta
        status:
          type: string
          enum: [PENDING, CANCELLED, COMPLETED]
          description: Estado de la solicitud
          example: PENDING
        reason:
          oneOf:
            - type: string
            - type: 'null'
          description: Razón proporcionada por el usuario
        scheduled_deletion_date:
          type: string
          format: date-time
          description: Fecha programada para eliminación
        cancelled_at:
          oneOf:
            - type: string
              format: date-time
            - type: 'null'
          description: Fecha de cancelación (si aplica)
        metadata:
          type: object
          description: Metadatos adicionales de la solicitud
          properties:
            grace_period_days:
              type: integer
              description: Días de período de gracia
              example: 30
    AccountDeletionStatusResponse:
      type: object
      required: [has_active_request]
      additionalProperties: false
      properties:
        has_active_request:
          type: boolean
          description: Indica si hay una solicitud activa
          example: true
        request:
          oneOf:
            - $ref: '#/components/schemas/AccountDeletionResponse'
            - type: 'null'
          description: Detalles de la solicitud (si existe)
    NotificationSettingsResponse:
      type: object
      required:
        - id_user_notification_setting
        - id_user_profile
        - push_enabled
        - email_enabled
      additionalProperties: false
      properties:
        id_user_notification_setting:
          type: integer
          description: ID único de la configuración
        id_user_profile:
          type: integer
          description: ID del perfil de usuario
        push_enabled:
          type: boolean
          description: Notificaciones push habilitadas
          example: true
        email_enabled:
          type: boolean
          description: Notificaciones por email habilitadas
          example: true
        reminder_enabled:
          type: boolean
          description: Recordatorios habilitados
          example: true
        achievement_enabled:
          type: boolean
          description: Notificaciones de logros habilitadas
          example: true
        reward_enabled:
          type: boolean
          description: Notificaciones de recompensas habilitadas
          example: true
        gym_news_enabled:
          type: boolean
          description: Novedades de gimnasios habilitadas
          example: false
        quiet_hours_start:
          oneOf:
            - type: string
              pattern: '^([0-1][0-9]|2[0-3]):[0-5][0-9]$'
            - type: 'null'
          description: Inicio de horario silencioso (HH:MM)
          example: '22:00'
        quiet_hours_end:
          oneOf:
            - type: string
              pattern: '^([0-1][0-9]|2[0-3]):[0-5][0-9]$'
            - type: 'null'
          description: Fin de horario silencioso (HH:MM)
          example: '08:00'
        created_at:
          type: string
          format: date-time
          description: Fecha de creación
        updated_at:
          oneOf:
            - type: string
              format: date-time
            - type: 'null'
          description: Fecha de última actualización
    UpdateNotificationSettingsRequest:
      type: object
      additionalProperties: false
      properties:
        push_enabled:
          type: boolean
          description: Habilitar/deshabilitar notificaciones push
        email_enabled:
          type: boolean
          description: Habilitar/deshabilitar notificaciones por email
        reminder_enabled:
          type: boolean
          description: Habilitar/deshabilitar recordatorios
        achievement_enabled:
          type: boolean
          description: Habilitar/deshabilitar notificaciones de logros
        reward_enabled:
          type: boolean
          description: Habilitar/deshabilitar notificaciones de recompensas
        gym_news_enabled:
          type: boolean
          description: Habilitar/deshabilitar novedades de gimnasios
        quiet_hours_start:
          type: string
          pattern: '^([0-1][0-9]|2[0-3]):[0-5][0-9]$'
          description: Inicio de horario silencioso (HH:MM)
          example: '22:00'
        quiet_hours_end:
          type: string
          pattern: '^([0-1][0-9]|2[0-3]):[0-5][0-9]$'
          description: Fin de horario silencioso (HH:MM)
          example: '08:00'
    UpdateTokensRequest:
      type: object
      required: [delta]
      additionalProperties: false
      properties:
        delta:
          type: integer
          description: Cantidad a incrementar (positivo) o decrementar (negativo)
          example: 50
        reason:
          type: string
          maxLength: 255
          description: Razón del ajuste de tokens
          example: Recompensa por evento especial
    TokensUpdateResponse:
      type: object
      required: [id_user_profile, new_balance, delta]
      additionalProperties: false
      properties:
        id_user_profile:
          type: integer
          description: ID del perfil de usuario
        new_balance:
          type: integer
          minimum: 0
          description: Nuevo balance de tokens
          example: 200
        delta:
          type: integer
          description: Cantidad ajustada
          example: 50
    UpdateSubscriptionRequest:
      type: object
      required: [subscription]
      additionalProperties: false
      properties:
        subscription:
          type: string
          enum: [FREE, PREMIUM]
          description: Nuevo nivel de suscripción
          example: PREMIUM

    # ========================================================================
    # LOTE 4: GYM SCHEDULES, REVIEWS, PAYMENTS SCHEMAS
    # ========================================================================

    # --- GYM SCHEDULES ---
    CreateGymScheduleRequest:
      type: object
      required: [day_of_week, open_time, close_time]
      additionalProperties: false
      properties:
        day_of_week:
          type: integer
          minimum: 0
          maximum: 6
          description: Día de la semana (0=Domingo, 1=Lunes, ..., 6=Sábado)
          example: 1
        open_time:
          type: string
          pattern: '^([0-1][0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?$'
          description: Hora de apertura (HH:MM o HH:MM:SS)
          example: '06:00'
        close_time:
          type: string
          pattern: '^([0-1][0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?$'
          description: Hora de cierre (HH:MM o HH:MM:SS)
          example: '22:00'
        is_closed:
          type: boolean
          default: false
          description: Si el gimnasio está cerrado ese día

    GymScheduleResponse:
      type: object
      required: [id_schedule, id_gym, day_of_week, open_time, close_time, is_closed]
      additionalProperties: false
      properties:
        id_schedule:
          type: integer
          description: ID del horario
        id_gym:
          type: integer
          description: ID del gimnasio
        day_of_week:
          type: integer
          minimum: 0
          maximum: 6
          description: Día de la semana
        open_time:
          type: string
          description: Hora de apertura
          example: '06:00:00'
        close_time:
          type: string
          description: Hora de cierre
          example: '22:00:00'
        is_closed:
          type: boolean
          description: Si está cerrado

    GymSchedulesWeekResponse:
      type: object
      description: Horarios de la semana (0=Domingo a 6=Sábado)
      additionalProperties: false
      properties:
        '0':
          oneOf:
            - $ref: '#/components/schemas/GymScheduleResponse'
            - type: 'null'
        '1':
          oneOf:
            - $ref: '#/components/schemas/GymScheduleResponse'
            - type: 'null'
        '2':
          oneOf:
            - $ref: '#/components/schemas/GymScheduleResponse'
            - type: 'null'
        '3':
          oneOf:
            - $ref: '#/components/schemas/GymScheduleResponse'
            - type: 'null'
        '4':
          oneOf:
            - $ref: '#/components/schemas/GymScheduleResponse'
            - type: 'null'
        '5':
          oneOf:
            - $ref: '#/components/schemas/GymScheduleResponse'
            - type: 'null'
        '6':
          oneOf:
            - $ref: '#/components/schemas/GymScheduleResponse'
            - type: 'null'

    # --- GYM REVIEWS ---
    CreateGymReviewRequest:
      type: object
      required: [rating]
      additionalProperties: false
      properties:
        rating:
          type: number
          format: float
          minimum: 1.0
          maximum: 5.0
          description: Rating general del gimnasio
          example: 4.5
        title:
          type: string
          maxLength: 100
          description: Título de la reseña
          example: Excelente gimnasio
        comment:
          type: string
          maxLength: 1000
          description: Comentario detallado
          example: Muy buenas instalaciones y personal amable
        cleanliness_rating:
          type: integer
          minimum: 1
          maximum: 5
          description: Rating de limpieza
        equipment_rating:
          type: integer
          minimum: 1
          maximum: 5
          description: Rating de equipamiento
        staff_rating:
          type: integer
          minimum: 1
          maximum: 5
          description: Rating del personal
        facilities_rating:
          type: integer
          minimum: 1
          maximum: 5
          description: Rating de instalaciones
        value_rating:
          type: integer
          minimum: 1
          maximum: 5
          description: Rating de relación calidad-precio

    GymReviewResponse:
      type: object
      required: [id_review, id_gym, id_user_profile, rating, created_at, updated_at]
      additionalProperties: false
      properties:
        id_review:
          type: integer
          description: ID de la reseña
        id_gym:
          type: integer
          description: ID del gimnasio
        id_user_profile:
          type: integer
          description: ID del usuario autor
        rating:
          type: number
          format: float
          description: Rating general
        title:
          type: string
          nullable: true
          description: Título
        comment:
          type: string
          nullable: true
          description: Comentario
        cleanliness_rating:
          type: integer
          nullable: true
        equipment_rating:
          type: integer
          nullable: true
        staff_rating:
          type: integer
          nullable: true
        facilities_rating:
          type: integer
          nullable: true
        value_rating:
          type: integer
          nullable: true
        helpful_count:
          type: integer
          description: Votos útiles
          default: 0
        not_helpful_count:
          type: integer
          description: Votos no útiles
          default: 0
        user:
          type: object
          description: Info del usuario autor
          properties:
            id_user_profile:
              type: integer
            name:
              type: string
            profile_picture_url:
              type: string
              nullable: true
        user_voted:
          type: boolean
          nullable: true
          description: Si el usuario actual votó útil
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    PaginatedGymReviewsResponse:
      type: object
      required: [items, page, limit, total, totalPages]
      additionalProperties: false
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/GymReviewResponse'
        page:
          type: integer
          minimum: 1
        limit:
          type: integer
          minimum: 1
        total:
          type: integer
          minimum: 0
        totalPages:
          type: integer
          minimum: 0

    # --- GYM PAYMENTS ---
    CreateGymPaymentRequest:
      type: object
      required: [amount]
      additionalProperties: false
      properties:
        amount:
          type: number
          format: float
          minimum: 0.01
          description: Monto del pago
          example: 1500.00
        payment_method:
          type: string
          maxLength: 50
          description: Método de pago
          example: efectivo
        payment_date:
          type: string
          format: date-time
          description: Fecha del pago
        period_start:
          type: string
          format: date
          description: Inicio del período pagado
        period_end:
          type: string
          format: date
          description: Fin del período pagado
        reference_number:
          type: string
          maxLength: 100
          description: Número de referencia
        notes:
          type: string
          maxLength: 500
          description: Notas adicionales

    GymPaymentResponse:
      type: object
      required: [id_payment, id_user_profile, id_gym, amount, payment_date, status, created_at]
      additionalProperties: false
      properties:
        id_payment:
          type: integer
          description: ID del pago
        id_user_profile:
          type: integer
          description: ID del usuario
        id_gym:
          type: integer
          description: ID del gimnasio
        amount:
          type: number
          format: float
          description: Monto pagado
        payment_method:
          type: string
          nullable: true
          description: Método de pago
        payment_date:
          type: string
          format: date-time
          description: Fecha del pago
        period_start:
          type: string
          format: date
          nullable: true
          description: Inicio del período
        period_end:
          type: string
          format: date
          nullable: true
          description: Fin del período
        status:
          type: string
          enum: [PENDING, COMPLETED, FAILED, REFUNDED]
          description: Estado del pago
        reference_number:
          type: string
          nullable: true
          description: Número de referencia
        notes:
          type: string
          nullable: true
          description: Notas
        gym:
          type: object
          description: Info del gimnasio
          properties:
            id_gym:
              type: integer
            name:
              type: string
            city:
              type: string
        user:
          type: object
          description: Info del usuario
          properties:
            id_user_profile:
              type: integer
            name:
              type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
          nullable: true

    PaginatedGymPaymentsResponse:
      type: object
      required: [items, page, limit, total, totalPages]
      additionalProperties: false
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/GymPaymentResponse'
        page:
          type: integer
          minimum: 1
        limit:
          type: integer
          minimum: 1
        total:
          type: integer
          minimum: 0
        totalPages:
          type: integer
          minimum: 0
